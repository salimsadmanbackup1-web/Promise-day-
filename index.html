<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Promise Day Special</title>
    <style>
        :root {
            --bg-color: #e3f2fd;
            --envelope-color: #64b5f6;
            --envelope-dark: #42a5f5;
            --text-color: #0d47a1;
        }

        body {
            background-color: var(--bg-color);
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            font-family: 'Arial', sans-serif;
            overflow: hidden;
        }

        .envelope-wrapper {
            position: relative;
            cursor: pointer;
            width: 300px;
            height: 200px;
        }

        .envelope {
            position: absolute;
            width: 100%;
            height: 100%;
            background: var(--envelope-color);
            border-radius: 0 0 10px 10px;
            z-index: 2;
            box-shadow: 0 15px 30px rgba(0,0,0,0.1);
        }

        .flap {
            position: absolute;
            top: 0;
            width: 0;
            height: 0;
            border-left: 150px solid transparent;
            border-right: 150px solid transparent;
            border-top: 100px solid var(--envelope-dark);
            transform-origin: top;
            transition: transform 0.6s ease;
            z-index: 4;
        }

        .letter {
            position: absolute;
            bottom: 5px;
            left: 15px;
            right: 15px;
            height: 180px;
            background: white;
            border-radius: 5px;
            padding: 20px;
            text-align: center;
            transition: all 0.8s ease;
            z-index: 1; 
            box-sizing: border-box;
            opacity: 0;
        }

        .letter h2 { color: var(--text-color); font-size: 18px; margin-top: 0; }
        .letter p { font-size: 14px; line-height: 1.5; color: #333; margin: 5px 0; }

        .open .flap {
            transform: rotateX(180deg);
            z-index: 0;
        }

        .open .letter {
            transform: translateY(-130px);
            height: 350px;
            z-index: 3;
            opacity: 1;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .click-text {
            position: absolute;
            bottom: -50px;
            width: 100%;
            text-align: center;
            color: var(--text-color);
            font-weight: bold;
            animation: bounce 1s infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }
    </style>
</head>
<body>

    <div class="envelope-wrapper" id="mainWrapper" onclick="openAndPlay()">
        <div class="flap"></div>
        <div class="envelope"></div>
        <div class="letter">
            <h2>Happy Promise Day! ‚ù§Ô∏è</h2>
            <p><b>My Love,</b></p>
            <p>I promise to be your strength in every high and low.</p>
            <p>I promise to listen, understand, and grow with you.</p>
            <p>I promise to handle your mood swings <b>with a smile</b>. üòä</p>
            <p>I promise to stay by your side forever.</p>
            <p style="font-style: italic; color: #555; margin-top: 15px;">"I don't just promise you my words, I promise you my life."</p>
            <p><b>Always Yours, <br> SALIM SADMAN SHORON</b></p>
        </div>
        <div class="click-text">Click to open your Promise üíå</div>
    </div>

    <audio id="smileAudio">
        <source src="smile.mp3" type="audio/mpeg">
    </audio>

    <script>
        function openAndPlay() {
            document.getElementById('mainWrapper').classList.add('open');
            var audio = document.getElementById("smileAudio");
            audio.play().catch(function(error) {
                console.log("Audio play failed. Make sure 'smile.mp3' is in the same folder.");
            });
        }
    </script>

</body>
</html>            <td id="sumMeal">0</td>
                <td>-</td>
                <td id="sumMealCost">0</td>
                <td id="sumFixed">0</td>
                <td id="sumTotal">0</td>
                <td id="sumDeposit">0</td>
                <td id="sumDue">0</td>
            </tr>
        </tfoot>
    </table>

    <div class="custom-section">
        <h4>Manual Additional Section</h4>
        <table id="customTable">
            <thead>
                <tr>
                    <th>Sl</th>
                    <th>Name</th>
                    <th>Meal</th>
                    <th>Rate</th>
                    <th>Meal Cost</th>
                    <th>Fixed</th>
                    <th>Total</th>
                    <th>Deposit</th>
                    <th>Due</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
        <div class="btn-group no-print">
            <button class="btn" style="background:#8e44ad; font-size:11px;" onclick="addManualRow()">+ Add Manual Row</button>
            <button class="btn btn-danger" style="font-size:11px;" onclick="removeManualRow()">- Remove Row</button>
        </div>
    </div>
</div>

<div class="btn-group no-print">
    <button class="btn" onclick="addRow()">Add Member</button>
    <button class="btn btn-danger" onclick="removeLastRow()">Remove Member</button>
    <button class="btn btn-pdf" onclick="downloadPDF()">Download Single Page PDF</button>
</div>

<script>
const tbody = document.querySelector("#mealTable tbody");
const customTbody = document.querySelector("#customTable tbody");
let perMemberCost = 0, currentMealRate = 0;

function calculateFixed() {
    const totalFixed = (Number(document.getElementById('rent').value) || 0) + 
                       (Number(document.getElementById('current').value) || 0) + 
                       (Number(document.getElementById('waste').value) || 0) + 
                       (Number(document.getElementById('cook').value) || 0) + 
                       (Number(document.getElementById('others').value) || 0);
    
    document.getElementById('displayTotalFixed').innerText = totalFixed.toFixed(2);
    if(tbody.rows.length > 0) {
        perMemberCost = totalFixed / tbody.rows.length;
        document.getElementById('displayPerMember').innerText = perMemberCost.toFixed(2);
        Array.from(tbody.rows).forEach(row => {
            row.cells[5].querySelector('input').value = perMemberCost.toFixed(2);
            refreshRowCalculations(row);
        });
    }
    updateFooter();
}

function addRow(){
    let row = tbody.insertRow();
    row.innerHTML = `<td>${tbody.rows.length}</td><td><input type="text"></td><td><input type="number" class="meal-input" oninput="globalRecalc()"></td><td><input type="number" class="editable-cell" oninput="manualRowCalc(this)"></td><td><input type="number" class="editable-cell"></td><td><input type="number" class="editable-cell" oninput="manualRowCalc(this)"></td><td><input type="number" class="editable-cell"></td><td><input type="number" class="editable-cell" oninput="manualRowCalc(this)"></td><td><input type="number" class="editable-cell"></td>`;
    calculateFixed();
}

function removeLastRow() { if (tbody.rows.length > 0) { tbody.deleteRow(-1); calculateFixed(); globalRecalc(); } }

function globalRecalc() {
    let tM = 0, tD = 0;
    Array.from(tbody.rows).forEach(r => {
        tM += Number(r.cells[2].querySelector('input').value || 0);
        tD += Number(r.cells[7].querySelector('input').value || 0);
    });
    currentMealRate = (tM > 0) ? (tD / tM) : 0;
    document.getElementById('mealRateDisplay').innerText = currentMealRate.toFixed(2);
    Array.from(tbody.rows).forEach(r => refreshRowCalculations(r));
    updateFooter();
}

function refreshRowCalculations(row) {
    const m = Number(row.cells[2].querySelector('input').value || 0), f = Number(row.cells[5].querySelector('input').value || 0), d = Number(row.cells[7].querySelector('input').value || 0);
    row.cells[3].querySelector('input').value = currentMealRate.toFixed(2);
    row.cells[4].querySelector('input').value = (m * currentMealRate).toFixed(2);
    row.cells[6].querySelector('input').value = ((m * currentMealRate) + f).toFixed(2);
    row.cells[8].querySelector('input').value = (((m * currentMealRate) + f) - d).toFixed(2);
}

function manualRowCalc(el) {
    const row = el.closest("tr");
    const m = Number(row.cells[2].querySelector('input').value || 0), r = Number(row.cells[3].querySelector('input').value || 0), f = Number(row.cells[5].querySelector('input').value || 0), d = Number(row.cells[7].querySelector('input').value || 0);
    row.cells[4].querySelector('input').value = (m * r).toFixed(2);
    row.cells[6].querySelector('input').value = ((m * r) + f).toFixed(2);
    row.cells[8].querySelector('input').value = (((m * r) + f) - d).toFixed(2);
    updateFooter();
}

function updateFooter(){
    let sM=0, sMC=0, sF=0, sT=0, sDep=0, sDue=0;
    Array.from(tbody.rows).forEach(r=>{
        sM += Number(r.cells[2].querySelector('input').value || 0);
        sMC += Number(r.cells[4].querySelector('input').value || 0);
        sF += Number(r.cells[5].querySelector('input').value || 0);
        sT += Number(r.cells[6].querySelector('input').value || 0);
        sDep += Number(r.cells[7].querySelector('input').value || 0);
        sDue += Number(r.cells[8].querySelector('input').value || 0);
    });
    document.getElementById("sumMeal").innerText = sM;
    document.getElementById("sumMealCost").innerText = sMC.toFixed(2);
    document.getElementById("sumFixed").innerText = sF.toFixed(2);
    document.getElementById("sumTotal").innerText = sT.toFixed(2);
    document.getElementById("sumDeposit").innerText = sDep.toFixed(2);
    document.getElementById("sumDue").innerText = sDue.toFixed(2);
}

function addManualRow() {
    let row = customTbody.insertRow();
    row.innerHTML = `<td>${customTbody.rows.length}</td><td><input type="text"></td><td><input type="number" class="meal-input" oninput="manualRowCalc(this)"></td><td><input type="number" class="editable-cell" oninput="manualRowCalc(this)"></td><td><input type="number" class="editable-cell"></td><td><input type="number" class="editable-cell" oninput="manualRowCalc(this)"></td><td><input type="number" class="editable-cell"></td><td><input type="number" class="editable-cell" oninput="manualRowCalc(this)"></td><td><input type="number" class="editable-cell"></td>`;
}
function removeManualRow() { if (customTbody.rows.length > 0) customTbody.deleteRow(-1); }

for(let i=0; i<10; i++) addRow();

function downloadPDF(){
    const element = document.getElementById("pdfArea");
    const opt = {
        margin: 5,
        filename: 'Mess_Accounts.pdf',
        image: { type: 'jpeg', quality: 0.98 },
        html2canvas: { scale: 2, useCORS: true },
        jsPDF: { unit: 'mm', format: 'a4', orientation: 'landscape' },
        pagebreak: { mode: 'avoid-all' } 
    };
    html2pdf().set(opt).from(element).save();
}
</script>
</body>
</html>"></td><td><input type="number" class="meal-input" oninput="manualRowCalc(this)"></td><td><input type="number" class="editable-cell" oninput="manualRowCalc(this)"></td><td><input type="number" class="editable-cell"></td><td><input type="number" class="editable-cell" oninput="manualRowCalc(this)"></td><td><input type="number" class="editable-cell"></td><td><input type="number" class="editable-cell" oninput="manualRowCalc(this)"></td><td><input type="number" class="editable-cell"></td>`;
}
function removeManualRow() { if (customTbody.rows.length > 0) customTbody.deleteRow(-1); }

for(let i=0; i<10; i++) addRow();

function downloadPDF(){
    const element = document.getElementById("pdfArea");
    const opt = {
        margin: [10, 5, 10, 5],
        filename: 'Mess_Report.pdf',
        image: { type: 'jpeg', quality: 1 },
        html2canvas: { scale: 2, useCORS: true, logging: false },
        jsPDF: { unit: 'mm', format: 'a4', orientation: 'landscape' },
        pagebreak: { mode: 'avoid-all' }
    };
    html2pdf().set(opt).from(element).save();
}
</script>

</body>
</html>ow(-1); }

for(let i=0; i<10; i++) addRow();

function downloadPDF(){
    const element = document.getElementById("pdfArea");
    const opt = {
        margin: [10, 5, 10, 5],
        filename: 'Mess_Report.pdf',
        image: { type: 'jpeg', quality: 0.98 },
        html2canvas: { scale: 2, useCORS: true, letterRendering: true, backgroundColor: '#ffffff' },
        jsPDF: { unit: 'mm', format: 'a4', orientation: 'landscape' },
        pagebreak: { mode: ['avoid-all', 'css', 'legacy'] }
    };
    html2pdf().set(opt).from(element).save();
}
</script>

</body>
</html>